<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Articles | IR Notes Hub</title>

  <link rel="icon" href="/assests/img/icon.png" type="image/png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap">

  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family:'Poppins',sans-serif; background:#050505; color:#e0e0e0; min-height:100vh; }
    header { background:#000; border-bottom:1px solid #1a1a1a; padding: 18px 18px; display:flex; align-items:center; justify-content:space-between; gap: 12px; flex-wrap: wrap; }
    header a { color:#ffeb3b; text-decoration:none; font-weight:800; }
    header a:hover { color:#00e5ff; }
    .auth { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .auth a, .auth button {
      border-radius: 999px; padding: 10px 14px;
      border: 1px solid #2a2a2a; background: transparent;
      color: #ffeb3b; font-weight: 800; cursor: pointer; text-decoration:none;
      transition: 0.25s;
    }
    .auth a:hover, .auth button:hover {
      color:#00e5ff; border-color:#0072ff;
      box-shadow:0 0 15px rgba(0,114,255,0.35);
      transform: translateY(-1px);
    }
    main { max-width: 1100px; margin: 0 auto; padding: 28px 18px 60px; }
    h1 { margin: 0 0 8px 0; font-size: 2rem; }
    p.lead { margin: 0 0 18px 0; color: #aaa; line-height: 1.6; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 16px; margin-top: 16px; }
    @media (min-width: 768px) { .grid { grid-template-columns: repeat(2, 1fr); } }

    .card {
      background: rgba(22,22,22,0.95);
      border: 1px solid #333;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.65);
    }
    .card h3 { margin: 0 0 8px 0; font-size: 1.15rem; color: #fff; }
    .meta { color:#777; font-size:0.85rem; margin-bottom: 10px; }
    .card p { margin: 0 0 12px 0; color: #bbb; line-height: 1.6; }

    .actions { display:flex; gap:10px; flex-wrap: wrap; }
    .actions button {
      border-radius: 999px; padding: 10px 14px;
      border: 1px solid #2a2a2a; background: transparent;
      color: #ffeb3b; font-weight: 800; cursor: pointer;
      transition: 0.25s;
    }
    .actions button:hover {
      color:#00e5ff; border-color:#0072ff;
      box-shadow:0 0 15px rgba(0,114,255,0.35);
      transform: translateY(-1px);
    }

    #msg { color:#888; margin-top: 10px; }
  </style>

  <!-- Supabase env must load before JS modules -->
  <script src="/assests/js/env.js"></script>
</head>
<body>
  <header>
    <a href="/">← Home</a>

    <div class="auth">
      <!-- Logged out -->
      <a id="loginLink" href="/login.html">Login</a>

      <!-- Logged in actions (moved here from home) -->
      <a id="submitPdfLink" href="/upload.html" style="display:none;">Submit PDF</a>
      <a id="mySubmissionsLink" href="/my-submissions.html" style="display:none;">My Submissions</a>

      <a href="/admin.html" id="adminLink" style="display:none;">Admin</a>
      <button id="logoutBtn" type="button" style="display:none;">Logout</button>
    </div>
  </header>

  <main>
    <h1>Articles</h1>
    <p class="lead">Approved PDFs appear here automatically. You must login to read/view.</p>

    <p id="msg">Loading…</p>
    <div id="list" class="grid"></div>
  </main>

  <script type="module" src="/assests/js/articles.js"></script>

  <!-- NEW: popup + auto refresh on login/logout -->
  <script type="module">
    function toast(message, type = "info") {
      const el = document.createElement("div");
      el.textContent = message;

      const colors = {
        info:  { bg: "rgba(0,114,255,0.20)", border: "#0072ff" },
        ok:    { bg: "rgba(0,230,118,0.18)", border: "#00e676" },
        warn:  { bg: "rgba(255,235,59,0.14)", border: "#ffeb3b" },
        bad:   { bg: "rgba(255,75,43,0.18)", border: "#ff4b2b" },
      };

      const c = colors[type] || colors.info;

      el.style.position = "fixed";
      el.style.right = "16px";
      el.style.bottom = "16px";
      el.style.zIndex = "99999";
      el.style.padding = "12px 14px";
      el.style.borderRadius = "14px";
      el.style.border = `1px solid ${c.border}`;
      el.style.background = c.bg;
      el.style.color = "#fff";
      el.style.backdropFilter = "blur(10px)";
      el.style.boxShadow = "0 12px 30px rgba(0,0,0,0.55)";
      el.style.fontWeight = "800";

      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2200);
    }

    const flash = sessionStorage.getItem("__flash");
    if (flash) {
      try {
        const { msg, type } = JSON.parse(flash);
        toast(msg, type);
      } catch {}
      sessionStorage.removeItem("__flash");
    }

    function setFlash(msg, type) {
      sessionStorage.setItem("__flash", JSON.stringify({ msg, type }));
    }

    const waitForSupabase = async () => {
      for (let i = 0; i < 50; i++) {
        if (window.supabase?.auth) return window.supabase;
        await new Promise(r => setTimeout(r, 50));
      }
      return null;
    };

    const supabase = await waitForSupabase();
    if (!supabase) {
      console.warn("Supabase client not found on window.supabase");
    } else {
      supabase.auth.onAuthStateChange((event) => {
        if (event === "SIGNED_IN") {
          setFlash("Logged in", "ok");
          location.reload();
        }
        if (event === "SIGNED_OUT") {
          setFlash("Logged out", "warn");
          location.reload();
        }
      });
    }
  </script>

  <!-- NEW: toggle auth buttons on this page -->
  <script>
    (async function () {
      // Wait a moment for /assests/js/articles.js to create window.supabase (if it does)
      for (let i = 0; i < 50; i++) {
        if (window.supabase?.auth) break;
        await new Promise(r => setTimeout(r, 50));
      }
      if (!window.supabase?.auth) return;

      const loginLink = document.getElementById("loginLink");
      const logoutBtn = document.getElementById("logoutBtn");
      const submitPdfLink = document.getElementById("submitPdfLink");
      const mySubmissionsLink = document.getElementById("mySubmissionsLink");

      const { data } = await window.supabase.auth.getSession();
      const loggedIn = !!data.session;

      if (loginLink) loginLink.style.display = loggedIn ? "none" : "";
      if (logoutBtn) logoutBtn.style.display = loggedIn ? "" : "none";
      if (submitPdfLink) submitPdfLink.style.display = loggedIn ? "" : "none";
      if (mySubmissionsLink) mySubmissionsLink.style.display = loggedIn ? "" : "none";
    })();
  </script>
</body>
</html>
